# uuid6-zig

This is a prototype [UUIDv6](https://github.com/uuid6/uuid6-ietf-draft) draft 01 implementation in [Zig](https://github.com/ziglang/zig). It also includes versions 1 & 3-5 for comparison.

## Installation

The library is contained entirely in `src/Uuid.zig`. Feel free to copy and customize or clone it as a submodule.

It targets Zig `master` and may not work on the latest release.

### Adding to your build.zig

```zig
libOrExe.addPackagePath("uuid6", "path/to/uuid6-zig/src/Uuid.zig");
```

## Usage

There are namespaces for the various UUID versions, `v1`, `v3` - `v7`. Each has a `create(...)` method to create a single UUID, or a `Source` that can be used to create many with shared parameters and/or state.

Sources are not thread-safe and should be protected with a mutex.

### Example

```zig
const std = @import("std");
const Uuid = @import("uuid6");

pub fn main() anyerror!void {
    var rng = std.rand.DefaultPrng.init(0);
    const source = Uuid.v4.Source.init(&rng.random);

    var i: usize = 0;
    while (i < 10) : (i += 1) {
        const uuid = source.create();
        std.debug.print("{}\n", .{uuid});
    }
}
```

See also `examples/bench`.

## Performance

The following table was generated by [hyperfine](https://github.com/sharkdp/hyperfine) running `examples/bench`:

### Thread-safe

| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `bench -n 10000000 -v 1` | 268.3 ± 0.7 | 267.2 | 269.4 | 1.60 ± 0.03 |
| `bench -n 10000000 -v 3` | 1492.2 ± 3.5 | 1488.4 | 1498.6 | 8.88 ± 0.16 |
| `bench -n 10000000 -v 4` | 168.1 ± 3.0 | 165.8 | 178.8 | 1.00 |
| `bench -n 10000000 -v 5` | 1355.7 ± 7.8 | 1349.5 | 1375.6 | 8.07 ± 0.15 |
| `bench -n 10000000 -v 6` | 369.4 ± 1.7 | 366.0 | 370.9 | 2.20 ± 0.04 |
| `bench -n 10000000 -v 7` | 464.1 ± 3.1 | 461.5 | 470.2 | 2.76 ± 0.05 |

These times are for 1e7 UUIDs, so for example each v4 takes ~16.8ns, and each v3 takes ~149ns.

### Single-threaded

| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `bench -n 10000000 -v 1` | 119.7 ± 0.4 | 119.0 | 120.6 | 1.00 |
| `bench -n 10000000 -v 3` | 1500.5 ± 3.0 | 1494.3 | 1504.9 | 12.54 ± 0.05 |
| `bench -n 10000000 -v 4` | 168.8 ± 0.9 | 167.0 | 170.3 | 1.41 ± 0.01 |
| `bench -n 10000000 -v 5` | 1364.7 ± 9.8 | 1346.1 | 1379.2 | 11.40 ± 0.09 |
| `bench -n 10000000 -v 6` | 230.4 ± 3.7 | 224.9 | 238.3 | 1.92 ± 0.03 |
| `bench -n 10000000 -v 7` | 389.8 ± 3.9 | 385.3 | 396.8 | 3.26 ± 0.03 |

Environment:
- OS: Windows 10
- CPU: AMD Ryzen 7 1700
- Build mode: `release-fast`
