# uuid6-zig

This is a prototype [UUIDv6](https://github.com/uuid6/uuid6-ietf-draft) draft 03 implementation in [Zig](https://github.com/ziglang/zig). It also includes versions 1 & 3-5 for comparison.

## Installation

The library is contained entirely in `src/Uuid.zig`. Feel free to copy and customize or clone it as a submodule.

It targets Zig `master` and may not work on the latest release.

### Adding to your build.zig

```zig
libOrExe.addPackagePath("uuid6", "path/to/uuid6-zig/src/Uuid.zig");
```

## Usage

There are namespaces for the various UUID versions, `v1`, `v3` - `v7`. Each has a `create(...)` method to create a single UUID, or a `Source` that can be used to create many with shared parameters and/or state.

Sources are not thread-safe and should be protected with a mutex.

### Example

```zig
const std = @import("std");
const Uuid = @import("uuid6");

pub fn main() anyerror!void {
    var rng = std.rand.DefaultPrng.init(0);
    const source = Uuid.v4.Source.init(&rng.random);

    var i: usize = 0;
    while (i < 10) : (i += 1) {
        const uuid = source.create();
        std.debug.print("{}\n", .{uuid});
    }
}
```

See also `examples/bench`.

## Performance

The following tables were generated by [hyperfine](https://github.com/sharkdp/hyperfine) running `examples/bench`.

Note that the times are for 1e7 UUIDs, so for example each v4 takes ~12ns, and each v3 takes ~99ns. Also note that the v1 benchmark is reusing a single random node, so it has 48 bits of entropy *for the whole test* rather than per-UUID.

### Thread-safe

| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `bench -n 10000000 -v 1` | 97.6 ± 0.8 | 96.4 | 99.4 | 1.00 |
| `bench -n 10000000 -v 3` | 990.0 ± 3.1 | 985.9 | 995.7 | 10.14 ± 0.09 |
| `bench -n 10000000 -v 4` | 120.8 ± 1.4 | 119.0 | 125.9 | 1.24 ± 0.02 |
| `bench -n 10000000 -v 5` | 737.9 ± 2.8 | 735.1 | 743.2 | 7.56 ± 0.07 |
| `bench -n 10000000 -v 6` | 188.6 ± 1.6 | 186.9 | 193.1 | 1.93 ± 0.02 |
| `bench -n 10000000 -v 7` | 205.7 ± 1.0 | 204.6 | 208.1 | 2.11 ± 0.02 |

### Single-threaded

| Command | Mean [ms] | Min [ms] | Max [ms] | Relative |
|:---|---:|---:|---:|---:|
| `bench -n 10000000 -v 1` | 66.6 ± 0.7 | 65.8 | 69.3 | 1.00 |
| `bench -n 10000000 -v 3` | 996.3 ± 2.4 | 993.5 | 1000.9 | 14.96 ± 0.17 |
| `bench -n 10000000 -v 4` | 119.5 ± 1.4 | 118.3 | 123.6 | 1.79 ± 0.03 |
| `bench -n 10000000 -v 5` | 740.6 ± 3.0 | 737.6 | 748.4 | 11.12 ± 0.13 |
| `bench -n 10000000 -v 6` | 151.1 ± 1.1 | 149.5 | 153.2 | 2.27 ± 0.03 |
| `bench -n 10000000 -v 7` | 205.2 ± 1.3 | 202.8 | 208.5 | 3.08 ± 0.04 |

Environment:
- OS: Windows 10
- CPU: AMD Ryzen 5 5600X
- Build mode: `release-fast`
